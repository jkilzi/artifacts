{"version":3,"file":"WorkflowDefinitionViewerPage.esm.js","sources":["../../../src/components/WorkflowDefinitionViewerPage/WorkflowDefinitionViewerPage.tsx"],"sourcesContent":["/*\n * Copyright 2024 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useMemo } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { useAsync } from 'react-use';\n\nimport { InfoCard, ResponseErrorPanel } from '@backstage/core-components';\nimport {\n  useApi,\n  useRouteRef,\n  useRouteRefParams,\n} from '@backstage/core-plugin-api';\nimport { usePermission } from '@backstage/plugin-permission-react';\n\nimport { Button, Grid, Tooltip } from '@material-ui/core';\nimport { Skeleton } from '@material-ui/lab';\n\nimport { orchestratorWorkflowExecutePermission } from '@red-hat-developer-hub/backstage-plugin-orchestrator-common';\n\nimport { orchestratorApiRef } from '../../api';\nimport {\n  executeWorkflowRouteRef,\n  workflowDefinitionsRouteRef,\n} from '../../routes';\nimport { BaseOrchestratorPage } from '../BaseOrchestratorPage';\nimport { EditorViewKind, WorkflowEditor } from '../WorkflowEditor';\nimport WorkflowDefinitionDetailsCard from './WorkflowDefinitionDetailsCard';\n\nexport const WorkflowDefinitionViewerPage = () => {\n  const { workflowId, format } = useRouteRefParams(workflowDefinitionsRouteRef);\n  const orchestratorApi = useApi(orchestratorApiRef);\n  const { loading: loadingPermission, allowed: canRun } = usePermission({\n    permission: orchestratorWorkflowExecutePermission,\n  });\n  const {\n    value: workflowOverviewDTO,\n    loading,\n    error,\n  } = useAsync(() => {\n    return orchestratorApi.getWorkflowOverview(workflowId);\n  }, []);\n  const navigate = useNavigate();\n  const executeWorkflowLink = useRouteRef(executeWorkflowRouteRef);\n\n  const workflowFormat = useMemo(\n    () => (format === 'json' ? 'json' : 'yaml'),\n    [format],\n  );\n\n  const handleExecute = () => {\n    navigate(executeWorkflowLink({ workflowId }));\n  };\n\n  return (\n    <BaseOrchestratorPage\n      title={workflowOverviewDTO?.data.name || workflowId}\n      type=\"Workflows\"\n      typeLink=\"/orchestrator\"\n    >\n      <Grid container spacing={2} direction=\"column\" wrap=\"nowrap\">\n        {error && (\n          <Grid item>\n            <ResponseErrorPanel error={error} />\n          </Grid>\n        )}\n        <Grid container item justifyContent=\"flex-end\" spacing={1}>\n          <Grid item>\n            {loading || loadingPermission ? (\n              <Skeleton variant=\"text\" width=\"5rem\" />\n            ) : (\n              <Tooltip\n                title=\"user not authorized to execute workflow\"\n                disableHoverListener={canRun}\n              >\n                <Button\n                  variant=\"contained\"\n                  color=\"primary\"\n                  onClick={handleExecute}\n                  disabled={!canRun}\n                >\n                  Run\n                </Button>\n              </Tooltip>\n            )}\n          </Grid>\n        </Grid>\n        <Grid item>\n          <WorkflowDefinitionDetailsCard\n            workflowOverview={workflowOverviewDTO?.data}\n            loading={loading}\n          />\n        </Grid>\n        <Grid item>\n          <InfoCard title=\"Workflow definition\">\n            <div style={{ height: '600px' }}>\n              <WorkflowEditor\n                kind={EditorViewKind.EXTENDED_DIAGRAM_VIEWER}\n                workflowId={workflowId}\n                format={workflowFormat}\n              />\n            </div>\n          </InfoCard>\n        </Grid>\n      </Grid>\n    </BaseOrchestratorPage>\n  );\n};\n"],"names":[],"mappings":"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"}