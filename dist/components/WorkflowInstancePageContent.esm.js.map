{"version":3,"file":"WorkflowInstancePageContent.esm.js","sources":["../../src/components/WorkflowInstancePageContent.tsx"],"sourcesContent":["/*\n * Copyright 2024 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react';\n\nimport { Content, InfoCard } from '@backstage/core-components';\n\nimport { Grid, makeStyles } from '@material-ui/core';\nimport moment from 'moment';\n\nimport {\n  AssessedProcessInstanceDTO,\n  ProcessInstanceDTO,\n} from '@red-hat-developer-hub/backstage-plugin-orchestrator-common';\n\nimport { VALUE_UNAVAILABLE } from '../constants';\nimport { EditorViewKind, WorkflowEditor } from './WorkflowEditor';\nimport { WorkflowProgress } from './WorkflowProgress';\nimport { WorkflowResult } from './WorkflowResult';\nimport { WorkflowRunDetail } from './WorkflowRunDetail';\nimport { WorkflowRunDetails } from './WorkflowRunDetails';\nimport { WorkflowVariablesViewer } from './WorkflowVariablesViewer';\n\nexport const mapProcessInstanceToDetails = (\n  instance: ProcessInstanceDTO,\n): WorkflowRunDetail => {\n  const name = instance.processName || instance.processId;\n  const start = instance.start ? moment(instance.start) : undefined;\n  let duration: string = VALUE_UNAVAILABLE;\n  if (start && instance.end) {\n    const end = moment(instance.end);\n    duration = moment.duration(start.diff(end)).humanize();\n  }\n\n  const started = start?.toDate().toLocaleString() ?? VALUE_UNAVAILABLE;\n\n  return {\n    id: instance.id,\n    name,\n    workflowId: instance.processId,\n    started,\n    duration,\n    category: instance.category,\n    status: instance.status,\n    description: instance.description,\n    businessKey: instance.businessKey,\n  };\n};\n\nconst useStyles = makeStyles(_ => ({\n  topRowCard: {\n    height: '20rem',\n  },\n  middleRowCard: {\n    height: '20rem',\n    overflow: 'auto',\n    wordBreak: 'break-word',\n  },\n  bottomRowCard: {\n    minHeight: '40rem',\n    height: '100%',\n  },\n  autoOverflow: { overflow: 'auto' },\n  recommendedLabelContainer: {\n    display: 'flex',\n    alignItems: 'center',\n    whiteSpace: 'nowrap',\n  },\n  recommendedLabel: { margin: '0 0.25rem' },\n}));\n\nexport const WorkflowInstancePageContent: React.FC<{\n  assessedInstance: AssessedProcessInstanceDTO;\n}> = ({ assessedInstance }) => {\n  const styles = useStyles();\n\n  const details = React.useMemo(\n    () => mapProcessInstanceToDetails(assessedInstance.instance),\n    [assessedInstance.instance],\n  );\n\n  const workflowdata = assessedInstance.instance?.workflowdata;\n  let instanceVariables;\n  if (workflowdata) {\n    instanceVariables = {\n      /* Since we are about to remove just the top-level property, shallow copy of the object is sufficient */\n      ...workflowdata,\n    };\n    if (instanceVariables.hasOwnProperty('result')) {\n      delete instanceVariables.result;\n    }\n  }\n\n  return (\n    <Content noPadding>\n      <Grid container spacing={2}>\n        <Grid item xs={12}>\n          <InfoCard\n            title=\"Details\"\n            divider={false}\n            className={styles.topRowCard}\n          >\n            <WorkflowRunDetails\n              details={details}\n              assessedBy={assessedInstance.assessedBy}\n            />\n          </InfoCard>\n        </Grid>\n\n        <Grid item xs={6}>\n          <InfoCard\n            title=\"Variables\"\n            divider={false}\n            className={styles.middleRowCard}\n            cardClassName={styles.autoOverflow}\n          >\n            {instanceVariables && (\n              <WorkflowVariablesViewer variables={instanceVariables} />\n            )}\n            {!instanceVariables && (\n              <div>The workflow instance has no variables</div>\n            )}\n          </InfoCard>\n        </Grid>\n        <Grid item xs={6}>\n          <WorkflowResult\n            assessedInstance={assessedInstance}\n            className={styles.middleRowCard}\n          />\n        </Grid>\n\n        <Grid item xs={6}>\n          <InfoCard\n            title=\"Workflow definition\"\n            divider={false}\n            className={styles.bottomRowCard}\n          >\n            <WorkflowEditor\n              workflowId={assessedInstance.instance.processId}\n              kind={EditorViewKind.DIAGRAM_VIEWER}\n              editorMode=\"text\"\n            />\n          </InfoCard>\n        </Grid>\n\n        <Grid item xs={6}>\n          <InfoCard\n            title=\"Workflow progress\"\n            divider={false}\n            className={styles.bottomRowCard}\n            cardClassName={styles.autoOverflow}\n          >\n            <WorkflowProgress\n              workflowError={assessedInstance.instance.error}\n              workflowNodes={assessedInstance.instance.nodes}\n              workflowStatus={assessedInstance.instance.status}\n            />\n          </InfoCard>\n        </Grid>\n      </Grid>\n    </Content>\n  );\n};\nWorkflowInstancePageContent.displayName = 'WorkflowInstancePageContent';\n"],"names":[],"mappings":"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"}