{"version":3,"file":"WorkflowProgressNodeModel.esm.js","sources":["../../src/components/WorkflowProgressNodeModel.ts"],"sourcesContent":["/*\n * Copyright 2024 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  NodeInstanceDTO,\n  ProcessInstanceErrorDTO,\n  ProcessInstanceStatusDTO,\n} from '@red-hat-developer-hub/backstage-plugin-orchestrator-common';\n\nimport { isNonNullable } from '../utils/TypeGuards';\n\nexport type WorkflowProgressNodeModel = NodeInstanceDTO & {\n  status?: ProcessInstanceStatusDTO;\n  error?: ProcessInstanceErrorDTO;\n};\n\nexport const fromNodeInstanceToWorkflowProgressNodeModel =\n  (\n    workflowStatus?: ProcessInstanceStatusDTO,\n    workflowError?: ProcessInstanceErrorDTO,\n  ) =>\n  (\n    node: NodeInstanceDTO,\n    nodeIndex: number,\n    nodes: NodeInstanceDTO[],\n  ): WorkflowProgressNodeModel => {\n    const isLastNode = nodeIndex === nodes.length - 1;\n    const model: WorkflowProgressNodeModel = {\n      ...node,\n      status: workflowStatus,\n      enter: node.enter,\n    };\n\n    if (isNonNullable(node.exit)) {\n      model.exit = node.exit;\n    }\n\n    if (node.definitionId === workflowError?.nodeDefinitionId) {\n      model.status = 'Error';\n      model.error = workflowError;\n    } else if (node.enter && node.exit) {\n      model.status = 'Completed';\n    } else if (!node.exit) {\n      model.status = 'Active';\n    }\n\n    if (\n      workflowStatus &&\n      isLastNode &&\n      ['ABORTED', 'SUSPENDED'].includes(workflowStatus)\n    ) {\n      model.status = workflowStatus;\n    }\n\n    return model;\n  };\n"],"names":[],"mappings":";;AA4BO,MAAM,8CACX,CACE,cAAA,EACA,kBAEF,CACE,IAAA,EACA,WACA,KAC8B,KAAA;AAC9B,EAAM,MAAA,UAAA,GAAa,SAAc,KAAA,KAAA,CAAM,MAAS,GAAA,CAAA,CAAA;AAChD,EAAA,MAAM,KAAmC,GAAA;AAAA,IACvC,GAAG,IAAA;AAAA,IACH,MAAQ,EAAA,cAAA;AAAA,IACR,OAAO,IAAK,CAAA,KAAA;AAAA,GACd,CAAA;AAEA,EAAI,IAAA,aAAA,CAAc,IAAK,CAAA,IAAI,CAAG,EAAA;AAC5B,IAAA,KAAA,CAAM,OAAO,IAAK,CAAA,IAAA,CAAA;AAAA,GACpB;AAEA,EAAI,IAAA,IAAA,CAAK,YAAiB,KAAA,aAAA,EAAe,gBAAkB,EAAA;AACzD,IAAA,KAAA,CAAM,MAAS,GAAA,OAAA,CAAA;AACf,IAAA,KAAA,CAAM,KAAQ,GAAA,aAAA,CAAA;AAAA,GACL,MAAA,IAAA,IAAA,CAAK,KAAS,IAAA,IAAA,CAAK,IAAM,EAAA;AAClC,IAAA,KAAA,CAAM,MAAS,GAAA,WAAA,CAAA;AAAA,GACjB,MAAA,IAAW,CAAC,IAAA,CAAK,IAAM,EAAA;AACrB,IAAA,KAAA,CAAM,MAAS,GAAA,QAAA,CAAA;AAAA,GACjB;AAEA,EACE,IAAA,cAAA,IACA,cACA,CAAC,SAAA,EAAW,WAAW,CAAE,CAAA,QAAA,CAAS,cAAc,CAChD,EAAA;AACA,IAAA,KAAA,CAAM,MAAS,GAAA,cAAA,CAAA;AAAA,GACjB;AAEA,EAAO,OAAA,KAAA,CAAA;AACT;;;;"}