{"version":3,"file":"StepperObjectField.esm.js","sources":["../../src/components/StepperObjectField.tsx"],"sourcesContent":["/*\n * Copyright 2024 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react';\n\nimport { JsonObject } from '@backstage/types';\n\nimport ObjectField from '@rjsf/core/lib/components/fields/ObjectField';\nimport { ErrorSchema, FieldProps, IdSchema } from '@rjsf/utils';\nimport type { JSONSchema7 } from 'json-schema';\n\nimport OrchestratorFormStepper, {\n  OrchestratorFormStep,\n  OrchestratorFormToolbar,\n} from './OrchestratorFormStepper';\n\nconst StepperObjectField = ({\n  formData,\n  schema,\n  uiSchema,\n  onChange,\n  registry,\n  idSchema,\n  errorSchema,\n  ...props\n}: FieldProps<JsonObject, JSONSchema7>) => {\n  if (schema.properties === undefined) {\n    throw new Error(\n      \"Stepper object field is not supported for schema that doesn't contain properties\",\n    );\n  }\n  const steps = Object.entries(schema.properties).reduce<\n    OrchestratorFormStep[]\n  >((prev, [key, subSchema]) => {\n    if (typeof subSchema === 'boolean') {\n      return prev;\n    }\n    return [\n      ...prev,\n      {\n        content: (\n          <>\n            <ObjectField<JsonObject, JSONSchema7>\n              {...props}\n              schema={{ ...subSchema, title: '' }} // the title is in the step\n              uiSchema={uiSchema?.[key] || {}}\n              formData={(formData?.[key] as JsonObject) || {}}\n              onChange={data => {\n                onChange({ ...formData, [key]: data });\n              }}\n              idSchema={idSchema[key] as IdSchema<JsonObject>}\n              registry={{\n                ...registry,\n                fields: {\n                  ...registry.fields,\n                  ObjectField: ObjectField, // undo override of objectfield\n                },\n              }}\n              errorSchema={errorSchema?.[key] as ErrorSchema<JsonObject>}\n            />\n            <OrchestratorFormToolbar />\n          </>\n        ),\n        title: subSchema.title || key,\n        key,\n      },\n    ];\n  }, []);\n  return <OrchestratorFormStepper steps={steps} />;\n};\n\nexport default StepperObjectField;\n"],"names":[],"mappings":";;;;AA4BA,MAAM,qBAAqB,CAAC;AAAA,EAC1B,QAAA;AAAA,EACA,MAAA;AAAA,EACA,QAAA;AAAA,EACA,QAAA;AAAA,EACA,QAAA;AAAA,EACA,QAAA;AAAA,EACA,WAAA;AAAA,EACA,GAAG,KAAA;AACL,CAA2C,KAAA;AACzC,EAAI,IAAA,MAAA,CAAO,eAAe,KAAW,CAAA,EAAA;AACnC,IAAA,MAAM,IAAI,KAAA;AAAA,MACR,kFAAA;AAAA,KACF,CAAA;AAAA,GACF;AACA,EAAA,MAAM,KAAQ,GAAA,MAAA,CAAO,OAAQ,CAAA,MAAA,CAAO,UAAU,CAAA,CAAE,MAE9C,CAAA,CAAC,IAAM,EAAA,CAAC,GAAK,EAAA,SAAS,CAAM,KAAA;AAC5B,IAAI,IAAA,OAAO,cAAc,SAAW,EAAA;AAClC,MAAO,OAAA,IAAA,CAAA;AAAA,KACT;AACA,IAAO,OAAA;AAAA,MACL,GAAG,IAAA;AAAA,MACH;AAAA,QACE,yBAEI,KAAA,CAAA,aAAA,CAAA,KAAA,CAAA,QAAA,EAAA,IAAA,kBAAA,KAAA,CAAA,aAAA;AAAA,UAAC,WAAA;AAAA,UAAA;AAAA,YACE,GAAG,KAAA;AAAA,YACJ,MAAQ,EAAA,EAAE,GAAG,SAAA,EAAW,OAAO,EAAG,EAAA;AAAA,YAClC,QAAU,EAAA,QAAA,GAAW,GAAG,CAAA,IAAK,EAAC;AAAA,YAC9B,QAAW,EAAA,QAAA,GAAW,GAAG,CAAA,IAAoB,EAAC;AAAA,YAC9C,UAAU,CAAQ,IAAA,KAAA;AAChB,cAAA,QAAA,CAAS,EAAE,GAAG,QAAA,EAAU,CAAC,GAAG,GAAG,MAAM,CAAA,CAAA;AAAA,aACvC;AAAA,YACA,QAAA,EAAU,SAAS,GAAG,CAAA;AAAA,YACtB,QAAU,EAAA;AAAA,cACR,GAAG,QAAA;AAAA,cACH,MAAQ,EAAA;AAAA,gBACN,GAAG,QAAS,CAAA,MAAA;AAAA,gBACZ,WAAA;AAAA;AAAA,eACF;AAAA,aACF;AAAA,YACA,WAAA,EAAa,cAAc,GAAG,CAAA;AAAA,WAAA;AAAA,SAChC,kBACC,KAAA,CAAA,aAAA,CAAA,uBAAA,EAAA,IAAwB,CAC3B,CAAA;AAAA,QAEF,KAAA,EAAO,UAAU,KAAS,IAAA,GAAA;AAAA,QAC1B,GAAA;AAAA,OACF;AAAA,KACF,CAAA;AAAA,GACF,EAAG,EAAE,CAAA,CAAA;AACL,EAAO,uBAAA,KAAA,CAAA,aAAA,CAAC,2BAAwB,KAAc,EAAA,CAAA,CAAA;AAChD;;;;"}